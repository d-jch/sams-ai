# 📁 数据库迁移系统架构

## 🏗️ 文件分工

| 文件                 | 职责       | 用途                                                                                  |
| -------------------- | ---------- | ------------------------------------------------------------------------------------- |
| `lib/migrate.ts`     | 核心迁移库 | 提供可复用的迁移函数 (`runMigrations`, `checkDatabaseConnection`, `checkTablesExist`) |
| `scripts/migrate.ts` | 命令行工具 | 用户友好的CLI接口，参数解析和错误提示                                                 |
| `sql/schema.sql`     | 数据库模式 | 包含实际的SQL DDL语句（表定义、索引、触发器、约束）                                   |

## 🔄 设计原则

1. **职责分离**: 核心库函数与用户接口分离
2. **代码复用**: CLI 工具复用核心库的功能
3. **安全执行**: 使用 `CREATE TABLE IF NOT EXISTS` 支持幂等操作
4. **测试友好**: 库函数易于单元测试

## 📖 使用指南

具体的迁移操作和故障排除请参见：

- `docs/DATABASE_MIGRATION.md` - 完整的迁移操作指南
- `docs/DEPLOYMENT.md` - 部署流程中的迁移步骤
