# 🧪 Phase 4 浏览器测试指南

**开发服务器**: http://localhost:5173\
**测试时间**: 约 15-20 分钟

---

## 🔐 步骤 1: 登录系统

1. **打开浏览器**: 访问 http://localhost:5173
2. **点击**: "登录" 或直接访问 http://localhost:5173/login
3. **使用研究员账户登录**:
   ```
   邮箱: researcher@sams.ai
   密码: Research123!@#
   ```
4. **验证**: 成功登录后应重定向到 Dashboard

---

## ✅ 步骤 2: 测试 Sanger 申请创建

### 2.1 导航到新建申请页

- Dashboard → 点击 "新建测序申请" 或访问 `/requests/new`

### 2.2 测试动态表单（重点！）

1. **测试 NGS 类型**:
   - 选择 "全基因组测序 (WGS)"
   - ✅ 应该看到 "预估成本" 字段
   - ✅ 备注字段 placeholder: "请输入备注信息"

2. **切换到 Sanger**:
   - 选择 "Sanger 测序"
   - ✅ "预估成本" 字段应该**消失**
   - ✅ 显示蓝色提示框: "Sanger
     测序申请创建后，请在申请详情页添加样品并选择引物"
   - ✅ 备注字段 placeholder 变为: "如：目标基因、扩增片段大小等"

3. **填写并提交**:
   ```
   项目名称: Sanger-Browser-Test-001
   测序类型: Sanger 测序
   优先级: 正常
   备注: 测试克隆验证流程
   ```
   - 点击 "创建申请"
   - ✅ 应该重定向到申请详情页 `/requests/{id}`

**✅ 通过标准**: 表单动态行为正常，提交成功

---

## 📋 步骤 3: 测试样品管理（Sanger 专属）

### 3.1 验证页面显示

- **当前页面**: 申请详情页
- ✅ 左侧卡片显示 "测序类型: Sanger测序"
- ✅ 下方有 "样品管理" 卡片（不是 "样品管理功能即将上线"）
- ✅ 显示 "+ 添加样品" 按钮

### 3.2 添加第一个样品

1. 点击 "+ 添加样品"
2. ✅ 展开表单，显示以下字段:
   - 样品名称 (必填)
   - 样品类型 (下拉选择: DNA/RNA/cDNA/PCR product/plasmid)
   - 浓度 (ng/μL)
   - 体积 (μL)
   - 备注

3. **填写测试数据**:
   ```
   样品名称: Sample-Browser-001
   样品类型: PCR product
   浓度: 75
   体积: 18
   备注: 测试样品
   ```

4. 点击 "添加"
5. ✅ 加载动画显示（旋转图标）
6. ✅ 表单自动关闭
7. ✅ 样品出现在列表中

### 3.3 验证样品列表显示

检查表格应显示:

- ✅ 样品名称: Sample-Browser-001
- ✅ 类型: PCR product (badge)
- ✅ 浓度: 75.0
- ✅ 体积: 18.0
- ✅ QC状态: 待检测 (黄色 badge)
- ✅ 引物选择: 下拉框（显示 "选择引物"）
- ✅ 操作: "详情" 链接

### 3.4 添加更多样品

重复步骤 3.2，添加 2-3 个样品用于后续测试

**✅ 通过标准**: 样品添加功能正常，列表实时更新

---

## 🧬 步骤 4: 测试引物选择

### 4.1 为样品分配引物

1. 在样品列表中，找到 "引物选择" 列
2. 点击第一个样品的下拉框
3. ✅ 应该看到引物列表，格式如:
   ```
   T7 Promoter (Tm: 58.5°C)
   SP6 Promoter (Tm: 57.2°C)
   M13 Forward (-20) (Tm: 56.8°C)
   ...
   ```

4. **选择一个引物** (如: T7 Promoter)
5. ✅ 页面自动保存（可能有短暂加载）
6. ✅ 下拉框保持选中状态

### 4.2 验证引物分配

- 刷新页面
- ✅ 引物选择应该保持（持久化成功）

**✅ 通过标准**: 引物选择功能正常，数据持久化

---

## 🔬 步骤 5: 测试技术员功能

### 5.1 切换账户

1. 点击右上角 "退出"
2. 重新登录，使用技术员账户:
   ```
   邮箱: technician@sams.ai
   密码: Tech123!@#
   ```

### 5.2 访问刚创建的申请

- Dashboard → 测序申请列表 → 找到 "Sanger-Browser-Test-001"
- 点击进入详情页

### 5.3 验证技术员可以看到样品

- ✅ 应该能看到之前添加的样品
- ✅ 可以继续添加样品
- ✅ 可以选择引物

**注意**: 目前 QC 和 Barcode 分配可能需要通过 API 测试（UI 集成可选）

**✅ 通过标准**: 技术员账户可以访问和操作样品

---

## 🎨 步骤 6: UI 和交互测试

### 6.1 响应式布局

1. **缩小浏览器窗口**
   - ✅ 表单应该适应小屏幕
   - ✅ 表格在小屏幕可横向滚动
   - ✅ 按钮和卡片正确堆叠

### 6.2 错误处理

1. **测试空表单提交**:
   - 点击 "+ 添加样品"
   - 不填写任何内容，直接点击 "添加"
   - ✅ 浏览器应显示 "请填写此字段" 提示
   - ✅ 必填字段有红色星号标记

2. **测试网络错误** (可选):
   - 打开浏览器开发者工具 (F12)
   - Network 标签 → 勾选 "Offline"
   - 尝试添加样品
   - ✅ 应显示错误提示

### 6.3 加载状态

1. 刷新页面
2. ✅ 初始加载时显示 loading spinner
3. ✅ 数据加载后 spinner 消失

**✅ 通过标准**: UI 响应良好，错误处理正确

---

## 🔍 步骤 7: 浏览器控制台检查

### 7.1 打开开发者工具

- 按 `F12` 或 `Ctrl+Shift+I` (Linux/Windows)
- 或 `Cmd+Option+I` (Mac)

### 7.2 检查 Console 标签

- ✅ **无红色错误** (除非故意触发的错误)
- ✅ 可能有一些蓝色的信息日志（正常）
- ❌ 如果看到红色错误，记录下来

### 7.3 检查 Network 标签

1. 刷新页面
2. 查看网络请求:
   - ✅ `/api/v1/samples?requestId=...` - 200 OK
   - ✅ `/api/v1/primers` - 200 OK
   - ✅ 所有 API 请求应返回 200 (成功) 或 302 (重定向)

**✅ 通过标准**: 无 JavaScript 错误，API 调用成功

---

## 📊 步骤 8: 测试不同测序类型对比

### 8.1 创建 NGS 申请

1. 新建申请
2. 选择 "全基因组测序 (WGS)"
3. 提交并查看详情页
4. ✅ 样品管理区域应显示: "NGS 样品管理功能即将上线..."
5. ✅ 不显示 SangerSampleManager 组件

### 8.2 对比 Sanger 申请

- 返回之前的 Sanger 申请
- ✅ 显示完整的样品管理界面
- ✅ 可以添加样品和选择引物

**✅ 通过标准**: 不同测序类型显示正确的界面

---

## 🎯 快速功能清单

在浏览器中快速验证以下功能:

- [ ] ✅ 登录/登出正常
- [ ] ✅ Sanger 测序选项在表单中可见
- [ ] ✅ 选择 Sanger 时预估成本字段隐藏
- [ ] ✅ 提示信息正确显示
- [ ] ✅ 申请创建成功
- [ ] ✅ 样品添加功能正常
- [ ] ✅ 样品列表显示正确
- [ ] ✅ 引物下拉框显示引物和 Tm 值
- [ ] ✅ 引物选择可以保存
- [ ] ✅ 技术员可以访问和操作
- [ ] ✅ QC 状态正确显示
- [ ] ✅ 响应式布局正常
- [ ] ✅ 无 JavaScript 错误

---

## 🐛 常见问题排查

### Q: 样品列表不显示

**A**:

1. 检查浏览器控制台是否有错误
2. 检查 Network 标签，`/api/v1/samples` 是否返回 200
3. 确认 requestId 正确

### Q: 引物下拉框为空

**A**:

1. 检查 `/api/v1/primers` API 是否返回数据
2. 数据库中应有 6 个预置引物
3. 运行: `psql $DATABASE_URL -c "SELECT COUNT(*) FROM primers;"`

### Q: 样品添加后没有反应

**A**:

1. 检查浏览器控制台是否有错误
2. 检查 POST `/api/v1/samples` 是否返回 201
3. 确认用户有权限创建样品

### Q: 页面显示 "样品管理功能即将上线"

**A**:

- 确认申请类型是 "sanger"
- 检查 `routes/requests/[id].tsx` 是否正确集成 SangerSampleManager

---

## 📸 测试截图建议

如需记录测试结果，建议截图:

1. Sanger 申请创建表单（显示提示信息）
2. 样品列表（显示多个样品）
3. 引物选择下拉框（显示 Tm 值）
4. 浏览器控制台（无错误）

---

## ✅ 测试完成标准

**Phase 4 功能测试通过条件**:

- ✅ 所有核心功能正常工作
- ✅ 无阻塞性错误
- ✅ 用户体验流畅
- ✅ 数据正确持久化

**预计测试时间**: 15-20 分钟

**祝测试顺利！** 🎉
